(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[459],{10115:(e,s,l)=>{Promise.resolve().then(l.bind(l,63602))},15634:(e,s,l)=>{"use strict";l.d(s,{d:()=>n});var t=l(20912);l(34012);var a=l(26221),r=l(87343);function n(e){let{className:s,...l}=e;return(0,t.jsx)(a.bL,{"data-slot":"switch",className:(0,r.cn)("peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",s),...l,children:(0,t.jsx)(a.zi,{"data-slot":"switch-thumb",className:(0,r.cn)("bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0")})})}},62807:(e,s,l)=>{"use strict";l.d(s,{w:()=>n});var t=l(20912);l(34012);var a=l(64356),r=l(87343);function n(e){let{className:s,orientation:l="horizontal",decorative:n=!0,...i}=e;return(0,t.jsx)(a.b,{"data-slot":"separator",decorative:n,orientation:l,className:(0,r.cn)("bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px",s),...i})}},63602:(e,s,l)=>{"use strict";l.r(s),l.d(s,{default:()=>V});var t=l(20912),a=l(34012),r=l(75714),n=l(60362),i=l(69982),o=l(53020),d=l(34478),c=l(85629),u=l(7206),m=l(2470),x=l(18847),h=l(39532),p=l(40566),f=l(24491),g=l(81985),v=l(26831),j=l(15151),b=l(76301),N=l(95370),w=l(21856),y=l(45082),k=l(65123),C=l(15634),_=l(5255),R=l(10333),S=l(29083),A=l(47560),E=l(87343);function P(e){let{className:s,...l}=e;return(0,t.jsx)(A.bL,{"data-slot":"tabs",className:(0,E.cn)("flex flex-col gap-2",s),...l})}function L(e){let{className:s,...l}=e;return(0,t.jsx)(A.B8,{"data-slot":"tabs-list",className:(0,E.cn)("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",s),...l})}function z(e){let{className:s,...l}=e;return(0,t.jsx)(A.l9,{"data-slot":"tabs-trigger",className:(0,E.cn)("data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",s),...l})}function F(e){let{className:s,...l}=e;return(0,t.jsx)(A.UC,{"data-slot":"tabs-content",className:(0,E.cn)("flex-1 outline-none",s),...l})}var T=l(47686),D=l(71546),O=l(87997),I=l(52062),$=l(38272),U=l(62807);function G(e){var s,l,n;let{mode:i,open:c,onOpenChange:u,initialData:m,roleId:x,roleTitle:h,onSubmit:p,onPermissionsSaved:g}=e,[v,j]=a.useState(null!=(s=null==m?void 0:m.name)?s:""),[b,w]=a.useState(null!=(l=null==m?void 0:m.description)?l:""),[_,R]=a.useState({user:!0,tickets:!1,reports:!1,invoices:!1}),[S,A]=a.useState(null!=(n=null==m?void 0:m.grants)?n:{}),[E,P]=a.useState(!1),[L,z]=a.useState(!1),[F,T]=a.useState([]),[D,G]=a.useState({});a.useEffect(()=>{var e,s,l;c&&(j(null!=(e=null==m?void 0:m.name)?e:""),w(null!=(s=null==m?void 0:m.description)?s:""),A(null!=(l=null==m?void 0:m.grants)?l:{}))},[c,m]),a.useEffect(()=>{c&&"permissions"===i&&x&&(async()=>{try{P(!0);let e=await (0,O.GL)(x);T(e);let s={};e.forEach(e=>{s[e.module_slug]=e.permissions.some(e=>e.is_allowed)}),G(s)}catch(l){var e,s;console.error(l),r.oR.error((null==l||null==(s=l.response)||null==(e=s.data)?void 0:e.message)||"Failed to load permissions")}finally{P(!1)}})()},[c,i,x]),Object.values(S).reduce((e,s)=>{var l;return e+(null!=(l=null==s?void 0:s.length)?l:0)},0);let B=F.reduce((e,s)=>e+s.permissions.filter(e=>e.is_allowed).length,0);function M(e){"permissions"===i?G(s=>({...s,[e]:!s[e]})):R(s=>({...s,[e]:!s[e]}))}async function H(){if(x)try{z(!0),await (0,O.je)({roleId:x,current:[],next:F}),r.oR.success("Permissions updated");let e=await (0,O.GL)(x);T(e),null==g||g(e),u(!1)}catch(l){var e,s;console.error(l),r.oR.error((null==l||null==(s=l.response)||null==(e=s.data)?void 0:e.message)||"Failed to update permissions")}finally{z(!1)}}return"permissions"===i?(0,t.jsx)(I.lG,{open:c,onOpenChange:u,children:(0,t.jsxs)(I.Cf,{className:"p-0 w-[95vw] max-w-none sm:w-[720px] sm:max-w-[720px] h-[80vh] max-h-[80vh] grid grid-rows-[auto,1fr,auto]",children:[(0,t.jsx)(I.c7,{className:"px-6 pt-6 pb-4 border-b sticky top-0 bg-background z-10",children:(0,t.jsxs)(I.L3,{className:"flex items-center gap-2",children:[(0,t.jsx)(f.A,{className:"h-5 w-5"}),"Permissions — ",h]})}),(0,t.jsx)("div",{className:"px-6 py-4 overflow-y-auto",children:E?(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"Loading…"}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"mb-3 flex items-center justify-between",children:[(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"Toggle which actions this role can access."}),(0,t.jsxs)(k.E,{variant:"secondary",children:[B," allowed"]})]}),(0,t.jsx)("div",{className:"space-y-3",children:F.map(e=>{let s=D[e.module_slug],l=e.permissions.filter(e=>e.is_allowed).length;return(0,t.jsxs)("div",{className:"rounded-xl border bg-card p-3",children:[(0,t.jsxs)("div",{role:"button",tabIndex:0,onClick:()=>M(e.module_slug),onKeyDown:s=>("Enter"===s.key||" "===s.key)&&M(e.module_slug),className:"flex cursor-pointer items-center justify-between rounded-lg p-2 hover:bg-muted/50",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[s?(0,t.jsx)(o.A,{className:"h-5 w-5 text-muted-foreground"}):(0,t.jsx)(d.A,{className:"h-5 w-5 text-muted-foreground"}),(0,t.jsx)("div",{className:"font-medium capitalize",children:e.module_slug})]}),(0,t.jsxs)(k.E,{variant:l?"default":"outline",children:[l," selected"]})]}),s&&(0,t.jsx)("div",{className:"mt-3 grid gap-3 md:grid-cols-2",children:e.permissions.map(s=>(0,t.jsxs)("label",{className:"flex items-center justify-between rounded-lg border p-3 hover:bg-muted/40",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium",children:s.permission_slug}),(0,t.jsxs)("div",{className:"mt-1 text-xs text-muted-foreground",children:["id: ",s.id]})]}),(0,t.jsx)(C.d,{checked:s.is_allowed,onCheckedChange:l=>{var t,a;return t=e.module_slug,a=s.id,void T(e=>e.map(e=>e.module_slug!==t?e:{...e,permissions:e.permissions.map(e=>e.id===a?{...e,is_allowed:l}:e)}))}})]},s.id))})]},e.module_slug)})})]})}),(0,t.jsxs)("div",{className:"px-6 py-4 border-t flex justify-end gap-2 sticky bg-background",children:[(0,t.jsx)(N.$,{variant:"outline",onClick:()=>u(!1),disabled:L,children:"Cancel"}),(0,t.jsx)(N.$,{onClick:H,disabled:L,children:L?"Saving…":"Save"})]})]})}):(0,t.jsx)(I.lG,{open:c,onOpenChange:u,children:(0,t.jsxs)(I.Cf,{className:"sm:max-w-3xl p-0",children:[(0,t.jsx)(I.c7,{className:"px-6 pt-6 pb-3",children:(0,t.jsxs)(I.L3,{className:"flex items-center gap-2",children:[(0,t.jsx)(f.A,{className:"h-5 w-5"}),"create"===i?"Create New Role":"Edit Role"]})}),(0,t.jsxs)("form",{onSubmit:function(e){e.preventDefault();let s={id:null==m?void 0:m.id,name:v.trim(),description:b.trim(),grants:S};null==p||p(s),u(!1)},className:"flex max-h-[90vh] flex-col",children:[(0,t.jsxs)("div",{className:"px-6 pb-6 overflow-y-auto max-h-[calc(90vh-160px)]",children:[(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)($.J,{htmlFor:"role-name",children:"Role Name *"}),(0,t.jsx)(y.p,{id:"role-name",placeholder:"Enter role name",value:v,onChange:e=>j(e.target.value),required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)($.J,{htmlFor:"role-desc",children:"Description *"}),(0,t.jsx)(y.p,{id:"role-desc",placeholder:"Brief description of the role",value:b,onChange:e=>w(e.target.value),required:!0})]})]}),(0,t.jsx)(U.w,{className:"my-4"})]}),(0,t.jsxs)("div",{className:"sticky flex justify-end gap-3 border-t bg-background px-6 py-4",children:[(0,t.jsx)(N.$,{type:"button",variant:"outline",onClick:()=>u(!1),children:"Cancel"}),(0,t.jsx)(N.$,{type:"submit",children:"create"===i?"Create":"Update"})]})]})]})})}var B=l(65988),M=l(37753);function H(e){let{roleId:s,roleTitle:l,canViewRolePerms:c,canUpdateRolePerms:u,onSaved:m}=e,[x,h]=a.useState([]),[p,f]=a.useState(!0),[g,v]=a.useState(!1),[j,b]=a.useState({}),[w,_]=a.useState("");a.useEffect(()=>{!async function(){if(s){f(!0);try{let e=await (0,O.GL)(s);h(e);let l={};e.forEach(e=>{l[e.module_slug]=!1}),b(l)}catch(e){console.error("Error fetching permissions:",e),r.oR.error("Failed to load permissions")}finally{f(!1)}}}()},[s]);let R=x.reduce((e,s)=>e+s.permissions.filter(e=>e.is_allowed).length,0),S=a.useMemo(()=>w.trim()?x.filter(e=>e.module_slug.toLowerCase().includes(w.toLowerCase())):x,[x,w]);function A(e){b(s=>({...s,[e]:!s[e]}))}async function E(){if(u){v(!0);try{await (0,O.je)({roleId:s,current:[],next:x}),r.oR.success("Permissions updated");let e=await (0,O.GL)(s);h(e),m(e)}catch(e){console.error(e),r.oR.error("Failed to update permissions")}finally{v(!1)}}}return p?(0,t.jsx)("div",{className:"py-4 text-sm text-muted-foreground",children:"Loading permissions..."}):c||u?(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"mb-3 flex items-center justify-between",children:[(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"Toggle which actions this role can access."}),(0,t.jsxs)(k.E,{variant:"secondary",children:[R," allowed"]})]}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(n.A,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),(0,t.jsx)(y.p,{type:"search",placeholder:"Search modules...",className:"w-full pl-8 pr-10",value:w,onChange:e=>_(e.target.value)}),w&&(0,t.jsxs)("button",{type:"button",onClick:function(){_("")},className:"absolute right-2.5 top-2.5 text-muted-foreground hover:text-foreground",children:[(0,t.jsx)(i.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"Clear search"})]})]}),(0,t.jsx)("div",{className:"space-y-3",children:0===S.length?(0,t.jsxs)("div",{className:"py-4 text-sm text-muted-foreground text-center",children:['No modules found matching "',w,'"']}):S.map(e=>{let s=!!j[e.module_slug],l=e.permissions.filter(e=>e.is_allowed).length;return(0,t.jsxs)("div",{className:"rounded-xl border bg-card p-3",children:[(0,t.jsxs)("div",{role:"button",tabIndex:0,onClick:()=>A(e.module_slug),onKeyDown:s=>("Enter"===s.key||" "===s.key)&&A(e.module_slug),className:"flex cursor-pointer items-center justify-between rounded-lg p-1 hover:bg-muted/50",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[s?(0,t.jsx)(o.A,{className:"h-4 w-4 text-muted-foreground"}):(0,t.jsx)(d.A,{className:"h-4 w-4 text-muted-foreground"}),(0,t.jsx)("div",{className:"font-medium capitalize text-sm",children:e.module_slug})]}),(0,t.jsxs)(k.E,{variant:l?"default":"outline",className:"text-xs",children:[l," selected"]})]}),s&&(0,t.jsx)("div",{className:"mt-2 grid gap-1 md:grid-cols-2",children:e.permissions.map(s=>(0,t.jsxs)("label",{className:"flex items-center justify-between rounded-lg border p-1.5 hover:bg-muted/40 text-sm",children:[(0,t.jsx)("div",{children:(0,t.jsx)("div",{className:"font-medium text-sm",children:s.permission_slug})}),(0,t.jsx)(C.d,{checked:s.is_allowed,onCheckedChange:l=>{var t,a;return t=e.module_slug,a=s.id,void(u&&h(e=>e.map(e=>e.module_slug!==t?e:{...e,permissions:e.permissions.map(e=>e.id===a?{...e,is_allowed:l}:e)})))},disabled:!u})]},s.id))})]},e.module_slug)})}),u&&(0,t.jsx)("div",{className:"flex justify-end gap-2",children:(0,t.jsx)(N.$,{onClick:E,disabled:g,children:g?"Saving…":"Save"})})]}):(0,t.jsx)("div",{className:"py-4 text-sm text-muted-foreground",children:"You don't have permission to view or update role permissions."})}function V(){var e,s,l,i,o;let[C,A]=a.useState(!1);a.useEffect(()=>A(!0),[]);let[E,I]=a.useState([]),[$,U]=a.useState(!0),[V,q]=a.useState(""),[Y,Z]=a.useState(1),[J,K]=a.useState(null),[Q,W]=a.useState(!1),[X,ee]=a.useState("create"),[es,el]=a.useState(null),[et,ea]=a.useState(null),[er,en]=a.useState({}),ei=(0,M.T)(B.c.roles.list),eo=(0,M.T)(B.c.roles.create);(0,M.T)(B.c.roles.read);let ed=(0,M.T)(B.c.roles.update),ec=(0,M.T)(B.c.roles.delete),eu=(0,M.T)(B.c.roles.extras.getRolePerms),em=(0,M.T)(B.c.roles.extras.updateRolePerms),[ex,eh]=a.useState("");a.useEffect(()=>{let e=setTimeout(()=>eh(V.trim()),300);return()=>clearTimeout(e)},[V]),a.useEffect(()=>{Z(1)},[ex]),a.useEffect(()=>{if(!C)return;let e=new AbortController;return(async()=>{try{if(U(!0),!ei){I([]),en({}),K(null);return}let{rows:s,pagination:l}=await (0,O.OH)(Y,5,ex||void 0,{signal:e.signal});I(s),K(null!=l?l:null)}catch(e){var s,l;if((null==e?void 0:e.code)==="ERR_CANCELED"||(null==e?void 0:e.message)==="canceled")return;console.error(e),r.oR.error((null==e||null==(l=e.response)||null==(s=l.data)?void 0:s.message)||"Failed to load roles")}finally{U(!1)}})(),()=>e.abort()},[C,ei,Y,5,ex]),a.useEffect(()=>{C&&ei&&eu&&(async()=>{try{let e=E.map(async e=>{try{let s=(await (0,O.GL)(e.id)).reduce((e,s)=>e+s.permissions.filter(e=>e.is_allowed).length,0);return{roleId:e.id,count:s}}catch(l){var s;if((null==l||null==(s=l.response)?void 0:s.status)===403)return{roleId:e.id,count:0};return console.error("Failed to load permissions for role ".concat(e.id,":"),l),{roleId:e.id,count:0}}}),s=await Promise.all(e),l={};s.forEach(e=>{let{roleId:s,count:t}=e;l[s]=t}),en(l)}catch(e){}})()},[C,ei,eu,E.length]);let ep=e=>eu?"number"==typeof er[e.id]?"".concat(er[e.id]," permissions"):"—":"No access",ef=async()=>{if(!ei)return;let{rows:e,pagination:s}=await (0,O.OH)(Y,5,ex||void 0);I(e),K(null!=s?s:null)};async function eg(e){if(C&&eo)try{await (0,O.rd)({title:e.name}),r.oR.success("Role created"),await ef()}catch(e){var s,l;console.error(e),r.oR.error((null==e||null==(l=e.response)||null==(s=l.data)?void 0:s.message)||"Create failed")}}async function ev(e){if(C&&ed)try{let s=await (0,O.Dc)(e);el(s),ee("edit"),W(!0)}catch(e){var s,l;console.error(e),r.oR.error((null==e||null==(l=e.response)||null==(s=l.data)?void 0:s.message)||"Failed to open role")}}async function ej(e){if(C&&ed&&(null==es?void 0:es.id))try{await (0,O.S0)({id:es.id,title:e.name}),r.oR.success("Role updated"),await ef()}catch(e){var s,l;console.error(e),r.oR.error((null==e||null==(l=e.response)||null==(s=l.data)?void 0:s.message)||"Update failed")}}async function eb(e){if(C&&ec)try{await (0,O.EO)(e),r.oR.success("Role deleted");let{rows:s,pagination:l}=await (0,O.OH)(Y,5,ex||void 0);0===s.length&&Y>1?Z(e=>e-1):(I(s),K(null!=l?l:null)),en(s=>{let l={...s};return delete l[e],l})}catch(e){var s,l;console.error(e),r.oR.error((null==e||null==(l=e.response)||null==(s=l.data)?void 0:s.message)||"Delete failed")}}let eN=e=>{if(!C)return"—";try{return new Date(e).toLocaleString()}catch(s){return e}},[ew,ey]=a.useState("roles"),ek=null!=(e=null==J?void 0:J.total)?e:E.length,eC=null!=(s=null==J?void 0:J.page)?s:Y,e_=(null!=(l=null==J?void 0:J.totalPages)?l:Math.ceil(ek/5))||1,eR=null!=(i=null==J?void 0:J.hasPrev)?i:eC>1,eS=null!=(o=null==J?void 0:J.hasNext)?o:eC<e_,eA=0===ek?0:(eC-1)*5+1,eE=0===ek?0:Math.min(5*eC,ek);return(0,t.jsx)(S.A,{screen:"/dashboard/roles",mode:"block",children:(0,t.jsxs)("div",{className:"space-y-6 scrollbar-stable",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsx)("h1",{className:"text-2xl sm:text-3xl font-bold truncate",children:"Roles"}),(0,t.jsx)("p",{className:"mt-1 text-sm text-muted-foreground",children:"Manage user roles and permissions"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 flex-wrap justify-end",children:[C&&!eo&&(0,t.jsxs)(k.E,{variant:"outline",className:"gap-1",children:[(0,t.jsx)(c.A,{className:"h-3.5 w-3.5"}),"No create access"]}),C&&"roles"===ew&&(0,t.jsxs)(N.$,{className:"gap-2 w-full sm:w-auto",onClick:()=>{ee("create"),W(!0)},disabled:!eo,children:[(0,t.jsx)(u.A,{className:"h-4 w-4"}),"Add Role"]})]})]}),(0,t.jsxs)(P,{defaultValue:"roles",className:"w-full",onValueChange:ey,children:[(0,t.jsxs)(L,{className:"mb-4",children:[(0,t.jsx)(z,{value:"roles",children:"Roles"}),(0,t.jsx)(z,{value:"permissions",children:"Role Permissions"})]}),(0,t.jsx)(F,{value:"roles",children:(0,t.jsxs)(w.Zp,{className:"shadow-sm",children:[(0,t.jsx)(w.aR,{className:"space-y-3",children:(0,t.jsxs)("div",{className:"flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between",children:[(0,t.jsx)(w.ZB,{className:"text-xl sm:text-2xl",children:"All Roles"}),(0,t.jsxs)("div",{className:"flex flex-col-reverse sm:flex-row sm:items-center gap-2 w-full lg:w-auto",children:[(0,t.jsxs)("div",{className:"relative w-full sm:w-[260px] md:w-[320px] lg:w-[350px] max-w-full",children:[(0,t.jsx)(n.A,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),(0,t.jsx)(y.p,{className:"h-9 pl-9 w-full",placeholder:"Search roles...",value:V,onChange:e=>q(e.target.value)})]}),(0,t.jsxs)(_.rI,{children:[(0,t.jsx)(_.ty,{asChild:!0,children:(0,t.jsxs)(N.$,{variant:"outline",size:"sm",className:"h-9 gap-1.5 border-muted-foreground/30 bg-background/60 px-3 text-xs font-medium text-muted-foreground shadow-sm hover:border-primary/40 hover:bg-primary/5 hover:text-primary self-end sm:self-auto",children:[(0,t.jsx)(m.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Export"})]})}),(0,t.jsxs)(_.SQ,{align:"end",className:"w-48",children:[(0,t.jsx)("div",{className:"px-2 py-1.5 text-xs text-muted-foreground",children:"Export current view"}),(0,t.jsxs)(_._2,{onClick:()=>{if(!E.length)return void r.oR.info("No roles to export.");let e=e=>'"'.concat(String(null!=e?e:"").replace(/"/g,'""'),'"'),s=E.map(e=>[e.title,eN(e.created_at),ep(e)]),l=new Blob([[["Role","Created At","Permissions"].map(e).join(",")].concat(s.map(s=>s.map(e).join(","))).join("\n")],{type:"text/csv;charset=utf-8;"}),t=URL.createObjectURL(l),a=document.createElement("a");a.href=t,a.setAttribute("download","roles.csv"),document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(t),r.oR.success("Roles exported as CSV.")},className:"cursor-pointer",children:[(0,t.jsx)(x.A,{className:"mr-2 h-4 w-4"})," Export as CSV"]}),(0,t.jsxs)(_._2,{onClick:()=>{if(!E.length)return void r.oR.info("No roles to export.");let e=window.open("","_blank");if(!e)return void r.oR.error("Popup blocked. Please allow popups to export PDF.");let s=E.map(e=>"\n          <tr>\n            <td>".concat(e.title,"</td>\n            <td>").concat(eN(e.created_at),"</td>\n            <td>").concat(ep(e),"</td>\n          </tr>\n        ")).join("");e.document.write('\n      <!DOCTYPE html>\n      <html>\n      <head>\n        <title>Roles Export</title>\n        <style>\n          body { font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; padding: 24px; }\n          h1 { font-size: 20px; margin-bottom: 16px; }\n          table { border-collapse: collapse; width: 100%; font-size: 12px; }\n          th, td { border: 1px solid #ddd; padding: 6px 8px; text-align: left; }\n          th { background: #f3f4f6; }\n          tr:nth-child(even) { background: #fafafa; }\n        </style>\n      </head>\n      <body>\n        <h1>Roles</h1>\n        <table>\n          <thead>\n            <tr>\n              <th>Role</th>\n              <th>Created At</th>\n              <th>Permissions</th>\n            </tr>\n          </thead>\n          <tbody>\n            '.concat(s,"\n          </tbody>\n        </table>\n      </body>\n      </html>\n    ")),e.document.close(),e.focus(),e.print()},className:"cursor-pointer",children:[(0,t.jsx)(h.A,{className:"mr-2 h-4 w-4"})," Export as PDF"]})]})]})]})]})}),(0,t.jsx)(w.Wu,{className:"px-3 sm:px-6",children:$?(0,t.jsx)("div",{className:"p-8 text-center text-sm text-muted-foreground",children:"Loading roles…"}):C&&!ei?(0,t.jsx)("div",{className:"p-8 text-center text-sm text-muted-foreground",children:"You don't have permission to view roles."}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"mt-1 rounded-xl border overflow-hidden overflow-x-auto",children:(0,t.jsxs)(D.XI,{className:"min-w-[640px]",children:[(0,t.jsx)(D.A0,{children:(0,t.jsxs)(D.Hj,{className:"bg-gray-200",children:[(0,t.jsx)(D.nd,{className:"rounded-tl-xl",children:"Role"}),(0,t.jsx)(D.nd,{children:"Created At"}),(0,t.jsx)(D.nd,{children:"Permissions"}),(0,t.jsx)(D.nd,{className:"text-right rounded-tr-xl",children:"Actions"})]})}),(0,t.jsx)(D.BF,{children:0===E.length?(0,t.jsx)(D.Hj,{children:(0,t.jsx)(D.nA,{colSpan:4,className:"p-8 text-center text-muted-foreground",children:(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center gap-3",children:[(0,t.jsx)(R.eu,{className:"h-16 w-16 border border-dashed border-muted-foreground/30 bg-muted/40",children:(0,t.jsx)(R.q5,{children:(0,t.jsx)(p.A,{className:"h-7 w-7 text-muted-foreground"})})}),(0,t.jsx)("div",{className:"text-sm font-medium text-foreground",children:"No roles found"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground max-w-xs",children:V?"No roles match your search. Try changing or clearing the search term.":"You don’t have any roles yet. Create your first role to start assigning permissions."})]})})}):E.map((e,s)=>{let l=s===E.length-1;return(0,t.jsxs)(D.Hj,{className:"odd:bg-muted/30 even:bg-white hover:bg-transparent",children:[(0,t.jsx)(D.nA,{className:"".concat(l?"rounded-bl-xl":""),children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(R.eu,{className:"h-9 w-9 shrink-0",children:(0,t.jsx)(R.q5,{className:"bg-primary/10 text-primary",children:(0,t.jsx)(f.A,{className:"h-4 w-4"})})}),(0,t.jsx)("div",{className:"min-w-0",children:(0,t.jsx)("div",{className:"font-medium truncate",children:e.title})})]})}),(0,t.jsx)(D.nA,{className:"text-sm text-muted-foreground",children:eN(e.created_at)}),(0,t.jsx)(D.nA,{children:(0,t.jsx)(k.E,{children:ep(e)})}),(0,t.jsx)(D.nA,{className:"text-right ".concat(l?"rounded-br-xl":""),children:(0,t.jsxs)(_.rI,{children:[(0,t.jsx)(_.ty,{asChild:!0,children:(0,t.jsx)(N.$,{variant:"ghost",size:"icon",className:"h-8 w-8","aria-label":"More actions",children:(0,t.jsx)(g.A,{className:"h-4 w-4"})})}),(0,t.jsxs)(_.SQ,{align:"end",className:"w-40",children:[ed&&(0,t.jsxs)(_._2,{className:"gap-2",onClick:()=>ev(e.id),children:[(0,t.jsx)(v.A,{className:"h-4 w-4"}),"Edit"]}),ec&&(0,t.jsxs)(_._2,{className:"gap-2 text-destructive focus:text-destructive",onClick:()=>eb(e.id),children:[(0,t.jsx)(j.A,{className:"h-4 w-4"}),"Delete"]})]})]})})]},e.id)})})]})}),(0,t.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between mt-4",children:[(0,t.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Showing ",eA," to ",eE," of ",ek," roles"]}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2 justify-end",children:[(0,t.jsxs)(N.$,{variant:"outline",size:"sm",disabled:!eR,className:"gap-1",onClick:()=>Z(e=>Math.max(1,e-1)),children:[(0,t.jsx)(b.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"hidden xs:inline",children:"Previous"})]}),(0,t.jsx)("div",{className:"flex items-center gap-1",children:Array.from({length:e_},(e,s)=>s+1).map(e=>(0,t.jsx)(N.$,{variant:e===eC?"default":"outline",size:"sm",className:"w-8 h-8 p-0 text-xs",onClick:()=>Z(e),children:e},e))}),(0,t.jsxs)(N.$,{variant:"outline",size:"sm",disabled:!eS,className:"gap-1",onClick:()=>Z(e=>e+1),children:[(0,t.jsx)("span",{className:"hidden xs:inline",children:"Next"}),(0,t.jsx)(d.A,{className:"h-4 w-4"})]})]})]})]})})]})}),(0,t.jsx)(F,{value:"permissions",children:(0,t.jsxs)(w.Zp,{className:"shadow-sm",children:[(0,t.jsx)(w.aR,{className:"pb-3",children:(0,t.jsx)(w.ZB,{className:"text-lg",children:"Role Permissions"})}),(0,t.jsx)(w.Wu,{children:$?(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"Loading roles…"}):C&&!ei?(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"You don't have permission to view roles."}):(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"w-full max-w-full sm:max-w-md lg:max-w-lg",children:[(0,t.jsx)("label",{htmlFor:"role-select",className:"block text-sm font-medium mb-2",children:"Select Role"}),(0,t.jsxs)(T.l6,{value:(null==et?void 0:et.id)||"",onValueChange:e=>{let s=E.find(s=>s.id===e);s&&(ea(s),(async()=>{if(null==er[s.id])try{let e=(await (0,O.GL)(s.id)).reduce((e,s)=>e+s.permissions.filter(e=>e.is_allowed).length,0);en(l=>({...l,[s.id]:e}))}catch(e){}})())},children:[(0,t.jsx)(T.bq,{className:"w-full",children:(0,t.jsx)(T.yv,{placeholder:"-- Select a role --"})}),(0,t.jsx)(T.gC,{className:"max-h-60",children:E.map(e=>(0,t.jsx)(T.eb,{value:e.id,children:e.title},e.id))})]})]}),et&&(0,t.jsx)(H,{roleId:et.id,roleTitle:et.title,canViewRolePerms:eu,canUpdateRolePerms:em,onSaved:e=>{let s=e.reduce((e,s)=>e+s.permissions.filter(e=>e.is_allowed).length,0);en(e=>et?{...e,[et.id]:s}:e)}})]})})]})})]}),(0,t.jsx)(G,{mode:X,open:Q,onOpenChange:W,initialData:es?{id:es.id,name:es.title,description:"",grants:{}}:void 0,roleId:"permissions"===X?null==et?void 0:et.id:void 0,roleTitle:"permissions"===X?null==et?void 0:et.title:void 0,onSubmit:"create"===X?eg:ej,onPermissionsSaved:e=>{let s=e.reduce((e,s)=>e+s.permissions.filter(e=>e.is_allowed).length,0);en(e=>et?{...e,[et.id]:s}:e)}})]})})}}},e=>{e.O(0,[809,57,641,189,484,290,741,808,4,358],()=>e(e.s=10115)),_N_E=e.O()}]);