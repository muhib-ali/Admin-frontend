(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[971],{8006:(e,l,t)=>{"use strict";t.r(l),t.d(l,{default:()=>E});var a=t(20912),s=t(34012),n=t(85798),i=t(74755),r=t(82159),d=t(7206),o=t(26831),c=t(15151),u=t(60362),m=t(76301),h=t(34478),x=t(81985),p=t(92292),g=t(21856),v=t(95370),f=t(45082),j=t(5255),w=t(87343),N=t(52062),b=t(38272),y=t(97636),k=t(15634);function A(e){var l,t,n,i,r;let{open:d,onOpenChange:o,mode:c,initial:u,onSubmit:m}=e,[h,x]=s.useState(null!=(l=null==u?void 0:u.name)?l:""),[p,g]=s.useState(null!=(t=null==u?void 0:u.slug)?t:""),[j,w]=s.useState(null!=(n=null==u?void 0:u.description)?n:""),[A,M]=s.useState(null!=(i=null==u?void 0:u.icon)?i:"Package"),[C,S]=s.useState(null==(r=null==u?void 0:u.active)||r);s.useEffect(()=>{var e,l,t,a,s;x(null!=(e=null==u?void 0:u.name)?e:""),g(null!=(l=null==u?void 0:u.slug)?l:""),w(null!=(t=null==u?void 0:u.description)?t:""),M(null!=(a=null==u?void 0:u.icon)?a:"Package"),S(null==(s=null==u?void 0:u.active)||s)},[u,d]),s.useEffect(()=>{"create"!==c||p.trim()||g(h.trim().replace(/\s+/g,"").replace(/[^A-Za-z0-9_-]/g,"").replace(/^-+|-+$/g,""))},[h,c,p]);let _=!h.trim()||!p.trim()||!j.trim();return(0,a.jsx)(N.lG,{open:d,onOpenChange:o,children:(0,a.jsxs)(N.Cf,{className:"w-[95vw] sm:max-w-lg",children:[(0,a.jsxs)(N.c7,{children:[(0,a.jsx)(N.L3,{children:"create"===c?"Create New Module":"Edit Module"}),(0,a.jsx)(N.rr,{children:"create"===c?"Add a new module to your system":"Update module information"})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(b.J,{htmlFor:"m-name",children:"Module Name *"}),(0,a.jsx)(f.p,{id:"m-name",placeholder:"e.g., Claim Management",value:h,onChange:e=>x(e.target.value)})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(b.J,{htmlFor:"m-slug",children:"Slug *"}),(0,a.jsx)(f.p,{id:"m-slug",placeholder:"claimManagement",value:p,onChange:e=>g(e.target.value)}),(0,a.jsxs)("p",{className:"text-[11px] text-muted-foreground",children:["Backend requires a slug (e.g. ",(0,a.jsx)("b",{children:"claimManagement"}),")"]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(b.J,{htmlFor:"m-desc",children:"Description *"}),(0,a.jsx)(y.T,{id:"m-desc",placeholder:"Describe what this module does",value:j,onChange:e=>w(e.target.value),rows:3})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(b.J,{htmlFor:"m-icon",children:"Icon Name (UI-only)"}),(0,a.jsx)(f.p,{id:"m-icon",placeholder:"Package",value:A,onChange:e=>M(e.target.value)}),(0,a.jsxs)("p",{className:"text-[11px] text-muted-foreground",children:["Lucide icon name (e.g. ",(0,a.jsx)("b",{children:"Package"}),", ",(0,a.jsx)("b",{children:"Boxes"}),", ",(0,a.jsx)("b",{children:"Users"}),")."]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between rounded-md border p-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(b.J,{className:"mb-0",children:"Active Status"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Enable this module for use"})]}),(0,a.jsx)(k.d,{checked:C,onCheckedChange:S})]})]}),(0,a.jsxs)(N.Es,{className:"mt-2",children:[(0,a.jsx)(v.$,{variant:"outline",onClick:()=>o(!1),children:"Cancel"}),(0,a.jsx)(v.$,{onClick:()=>{var e;m({id:null!=(e=null==u?void 0:u.id)?e:crypto.randomUUID(),name:h.trim(),slug:p.trim(),description:j.trim(),icon:A.trim()||"Package",active:C}),o(!1)},disabled:_,children:"create"===c?"Create":"Update"})]})]})})}var M=t(29083),C=t(22425),S=t(48924),_=t(65988),I=t(37753);function P(e){let{active:l}=e;return(0,a.jsx)("span",{className:(0,w.cn)("inline-flex items-center rounded-full px-2.5 py-1 text-xs font-medium",l?"bg-blue-100 text-blue-700 dark:bg-blue-500/15 dark:text-blue-300":"bg-muted text-muted-foreground"),children:l?"Active":"Inactive"})}function E(){var e,l,t,w,N;let[b,y]=(0,s.useState)([]),[k,E]=(0,s.useState)(!0),[F,T]=(0,s.useState)(1),[z,R]=(0,s.useState)(null),[D,$]=(0,s.useState)(""),[B,L]=(0,s.useState)(""),[U,J]=(0,s.useState)(!1),[O,Y]=(0,s.useState)("create"),[Z,K]=(0,s.useState)(void 0),q=(0,I.T)(_.c.modules.list),G=(0,I.T)(_.c.modules.create),Q=(0,I.T)(_.c.modules.update),W=(0,I.T)(_.c.modules.delete),H=e=>e.map(e=>{var l,t,a;return{id:e.id,name:e.title,slug:null!=(l=e.slug)?l:"",description:null!=(t=e.description)?t:"",icon:"Package",active:null!=(a=e.is_active)&&a}});(0,s.useEffect)(()=>{let e=setTimeout(()=>L(D.trim()),300);return()=>clearTimeout(e)},[D]),(0,s.useEffect)(()=>{T(1)},[B]),(0,s.useEffect)(()=>{let e=new AbortController;return(async()=>{try{if(E(!0),!q){y([]),R(null);return}let{rows:l,pagination:t}=await (0,C.su)(F,5,B||void 0,{signal:e.signal});y(H(l)),R(null!=t?t:null)}catch(e){var l,t;if((null==e?void 0:e.code)==="ERR_CANCELED"||(null==e?void 0:e.message)==="canceled")return;console.error(e),p.oR.error((null==e||null==(t=e.response)||null==(l=t.data)?void 0:l.message)||"Failed to load modules")}finally{E(!1)}})(),()=>e.abort()},[F,5,q,B]);let V=(0,s.useMemo)(()=>b,[b]),X=async()=>{if(!q)return;let{rows:e,pagination:l}=await (0,C.su)(F,5,B||void 0);y(H(e)),R(null!=l?l:null)},ee=async e=>{var l,t,a,s,n;if(Q)try{let s=await (0,C.P4)(e.id);Y("edit"),K({id:s.id,name:s.title,slug:null!=(l=s.slug)?l:"",description:null!=(t=s.description)?t:"",icon:e.icon||"Package",active:null!=(a=s.is_active)&&a}),J(!0)}catch(e){console.error(e),p.oR.error((null==e||null==(n=e.response)||null==(s=n.data)?void 0:s.message)||"Failed to open module")}},el=async e=>{try{if("create"===O){if(!G)return;await (0,C.Fi)({title:e.name,slug:e.slug,description:e.description||""}),p.oR.success("Module created")}else{if(!Q)return;await (0,C.YB)({id:e.id,title:e.name,slug:e.slug,description:e.description||""}),p.oR.success("Module updated")}await X(),J(!1),K(void 0)}catch(e){var l,t;console.error(e),p.oR.error((null==e||null==(t=e.response)||null==(l=t.data)?void 0:l.message)||"Save failed")}},et=async e=>{if(W&&window.confirm("This will delete all permissions under this module, then delete the module. Continue?"))try{for(let l of(await (0,S.pF)(e)))try{await (0,S.pK)(l.id)}catch(e){throw console.error("Failed deleting permission",l.id,e),e}await (0,C.s)(e),p.oR.success("Module and its permissions deleted");let{rows:l,pagination:t}=await (0,C.su)(F,5,B||void 0);0===l.length&&F>1?T(e=>e-1):(y(H(l)),R(null!=t?t:null))}catch(a){var l,t;console.error(a);let e=(null==a||null==(t=a.response)||null==(l=t.data)?void 0:l.message)||(null==a?void 0:a.message)||"Delete failed";p.oR.error(e)}},ea=d.A,es=o.A,en=c.A,ei=u.A,er=m.A,ed=h.A,eo=x.A,ec=null!=(e=null==z?void 0:z.total)?e:V.length,eu=null!=(l=null==z?void 0:z.page)?l:F,em=(null!=(t=null==z?void 0:z.totalPages)?t:Math.ceil(ec/5))||1,eh=null!=(w=null==z?void 0:z.hasPrev)?w:eu>1,ex=null!=(N=null==z?void 0:z.hasNext)?N:eu<em,ep=0===ec?0:(eu-1)*5+1,eg=0===ec?0:Math.min(5*eu,ec);return(0,a.jsx)(M.A,{screen:"/dashboard/modules",mode:"block",children:(0,a.jsxs)("div",{className:"space-y-6 scrollbar-stable",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl sm:text-3xl font-bold",children:"Modules"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-muted-foreground",children:"Manage system modules and features"})]}),(0,a.jsxs)(v.$,{className:"gap-2 w-full sm:w-auto",onClick:()=>{G&&(Y("create"),K(void 0),J(!0))},disabled:!G,children:[(0,a.jsx)(ea,{className:"h-4 w-4"}),"Add Module"]})]}),(0,a.jsxs)(g.Zp,{className:"shadow-sm",children:[(0,a.jsx)(g.aR,{className:"space-y-3",children:(0,a.jsxs)("div",{className:"flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between",children:[(0,a.jsx)(g.ZB,{className:"text-xl sm:text-2xl",children:"All Modules"}),(0,a.jsxs)("div",{className:"relative w-full sm:w-[260px] md:w-[320px] lg:w-[350px] max-w-full",children:[(0,a.jsx)(ei,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),(0,a.jsx)(f.p,{className:"h-9 pl-9 w-full",placeholder:"Search modules...",value:D,onChange:e=>$(e.target.value)})]})]})}),(0,a.jsxs)(g.Wu,{className:"px-3 sm:px-6",children:[(0,a.jsx)("div",{className:"mt-1 relative w-full overflow-x-auto rounded-xl border",children:(0,a.jsxs)("table",{className:"w-full min-w-[800px] caption-bottom text-sm",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"text-left bg-gray-200",children:[(0,a.jsx)("th",{className:"p-3 font-medium rounded-tl-xl",children:"Module"}),(0,a.jsx)("th",{className:"p-3 font-medium",children:"Description"}),(0,a.jsx)("th",{className:"p-3 font-medium",children:"Status"}),(0,a.jsx)("th",{className:"p-3 font-medium text-right rounded-tr-xl",children:"Actions"})]})}),(0,a.jsx)("tbody",{children:k?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:4,className:"p-8 text-center text-muted-foreground",children:"Loading modulesâ€¦"})}):q?(0,a.jsxs)(a.Fragment,{children:[V.map((e,l)=>{var t;let s=(t=e.icon)?i[t]||n.A||r.A:n.A,d=l===V.length-1;return(0,a.jsxs)("tr",{className:"odd:bg-muted/30 even:bg-white",children:[(0,a.jsx)("td",{className:"p-4 ".concat(d?"rounded-bl-xl":""),children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("span",{className:"grid h-10 w-10 place-items-center rounded-md bg-muted",children:(0,a.jsx)(s,{className:"h-5 w-5"})}),(0,a.jsxs)("div",{className:"font-medium",children:[e.name,(0,a.jsxs)("div",{className:"text-[11px] text-muted-foreground",children:["slug: ",e.slug]})]})]})}),(0,a.jsx)("td",{className:"p-4 text-muted-foreground",children:e.description}),(0,a.jsx)("td",{className:"p-4",children:(0,a.jsx)(P,{active:e.active})}),(0,a.jsx)("td",{className:"p-4 text-right ".concat(d?"rounded-br-xl":""),children:(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsxs)(j.rI,{children:[(0,a.jsx)(j.ty,{asChild:!0,children:(0,a.jsx)(v.$,{variant:"ghost",size:"icon",className:"h-8 w-8","aria-label":"More actions",children:(0,a.jsx)(eo,{className:"h-4 w-4"})})}),(0,a.jsxs)(j.SQ,{align:"end",className:"w-40",children:[Q&&(0,a.jsxs)(j._2,{className:"gap-2",onClick:()=>ee(e),children:[(0,a.jsx)(es,{className:"h-4 w-4"}),"Edit"]}),W&&(0,a.jsxs)(j._2,{className:"gap-2 text-destructive focus:text-destructive",onClick:()=>et(e.id),children:[(0,a.jsx)(en,{className:"h-4 w-4"}),"Delete"]})]})]})})})]},e.id)}),0===V.length&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:4,className:"p-8 text-center text-muted-foreground",children:"No modules found."})})]}):(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:4,className:"p-8 text-center text-muted-foreground",children:"You don't have permission to view modules."})})})]})}),(0,a.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between mt-4",children:[(0,a.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Showing ",ep," to ",eg," of ",ec," modules"]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2 justify-end",children:[(0,a.jsxs)(v.$,{variant:"outline",size:"sm",disabled:!eh,className:"gap-1",onClick:()=>T(e=>Math.max(1,e-1)),children:[(0,a.jsx)(er,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"Previous"})]}),(0,a.jsx)("div",{className:"flex items-center gap-1",children:Array.from({length:em},(e,l)=>l+1).map(e=>(0,a.jsx)(v.$,{variant:e===eu?"default":"outline",size:"sm",className:"w-8 h-8 p-0 text-xs",onClick:()=>T(e),children:e},e))}),(0,a.jsxs)(v.$,{variant:"outline",size:"sm",disabled:!ex,className:"gap-1",onClick:()=>T(e=>e+1),children:[(0,a.jsx)("span",{className:"hidden sm:inline",children:"Next"}),(0,a.jsx)(ed,{className:"h-4 w-4"})]})]})]})]})]}),(0,a.jsx)(A,{open:U,onOpenChange:e=>{J(e),e||K(void 0)},mode:O,initial:Z,onSubmit:el})]})})}},15634:(e,l,t)=>{"use strict";t.d(l,{d:()=>i});var a=t(20912);t(34012);var s=t(26221),n=t(87343);function i(e){let{className:l,...t}=e;return(0,a.jsx)(s.bL,{"data-slot":"switch",className:(0,n.cn)("peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",l),...t,children:(0,a.jsx)(s.zi,{"data-slot":"switch-thumb",className:(0,n.cn)("bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0")})})}},22425:(e,l,t)=>{"use strict";t.d(l,{Fi:()=>d,P4:()=>r,YB:()=>o,s:()=>c,su:()=>i});var a=t(43239);let s=e=>new Promise(l=>setTimeout(l,e));async function n(e){let{retries:l=4,baseDelayMs:t=400,maxDelayMs:a=8e3}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=0;for(;;)try{return await e()}catch(m){var i,r,d;let e=null==m||null==(i=m.response)?void 0:i.status,o=function(e){if(!e)return null;let l=Number(e);return Number.isFinite(l)?Math.max(0,l):null}(null==m||null==(d=m.response)||null==(r=d.headers)?void 0:r["retry-after"]);if(!(429===e&&n<l))throw m;let c=null!=o?1e3*o:Math.min(a,Math.round(t*Math.pow(2,n))),u=c*(.4*Math.random()-.2);c=Math.max(200,Math.round(c+u)),await s(c),n+=1;continue}}async function i(){var e,l,t;let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,r=arguments.length>2?arguments[2]:void 0,d=arguments.length>3?arguments[3]:void 0,o=function(e,l){let t={};for(let a of l){let l=e[a];null!=l&&(t[a]=l)}return t}({page:s,limit:i,search:(null==r?void 0:r.trim())||void 0},["page","limit","search"]),{data:c}=await n(()=>a.A.get("/modules/getAll",{params:o,signal:null==d?void 0:d.signal}));return{rows:null!=(t=null==c||null==(e=c.data)?void 0:e.modules)?t:[],pagination:null==c||null==(l=c.data)?void 0:l.pagination}}async function r(e){let{data:l}=await n(()=>a.A.get("/modules/getById/".concat(e)));return l.data}async function d(e){let{data:l}=await n(()=>a.A.post("/modules/create",e));return l.data}async function o(e){try{let{data:l}=await n(()=>a.A.post("/modules/update",e));return l.data}catch(t){let{data:l}=await n(()=>a.A.put("/modules/update",e));return l.data}}async function c(e){let{data:l}=await n(()=>a.A.delete("/modules/delete",{data:{id:e}}));return l.data}},48924:(e,l,t)=>{"use strict";t.d(l,{Iv:()=>u,LA:()=>h,iP:()=>m,pF:()=>c,pK:()=>x,zA:()=>o});var a=t(43239);let s=e=>new Promise(l=>setTimeout(l,e));async function n(e){let{retries:l=4,baseDelayMs:t=400,maxDelayMs:a=8e3}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=0;for(;;)try{return await e()}catch(m){var i,r,d;let e=null==m||null==(i=m.response)?void 0:i.status,o=function(e){if(null==e)return null;if("number"==typeof e)return e;let l=String(e).trim(),t=Number(l);if(!Number.isNaN(t))return Math.max(0,t);let a=Date.parse(l);return Number.isNaN(a)?null:Math.max(0,Math.ceil((a-Date.now())/1e3))}(null==m||null==(d=m.response)||null==(r=d.headers)?void 0:r["retry-after"]);if(!(429===e&&n<l))throw m;let c=null!=o?1e3*o:Math.min(a,Math.round(t*Math.pow(2,n))),u=c*(.4*Math.random()-.2);c=Math.max(200,Math.round(c+u)),await s(c),n+=1;continue}}function i(e,l){let t={};for(let a of l){let l=e[a];null!=l&&(t[a]=l)}return t}function r(e){return String(e).trim().toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-_]/g,"-").replace(/-+/g,"-")}function d(e){var l,t,a,s;return{id:e.id,moduleId:null!=(a=null!=(t=null!=(l=e.moduleId)?l:e.module_id)?t:e.module&&e.module.id)?a:"",title:e.title,slug:e.slug,description:null!=(s=e.description)?s:void 0,is_active:e.is_active,created_at:e.created_at,updated_at:e.updated_at}}async function o(e,l){var t,s,r,o,c;let u=null!=(r=null==e?void 0:e.page)?r:1,m=Math.min(null!=(o=null==e?void 0:e.limit)?o:10,100),h=null==e?void 0:e.moduleId,{data:x}=await n(()=>a.A.get("/permissions/getAll",{params:i({page:u,limit:m,moduleId:h},["page","limit","moduleId"]),signal:null==l?void 0:l.signal}));return{rows:(null!=(c=null==x||null==(t=x.data)?void 0:t.permissions)?c:[]).map(d),pagination:null==x||null==(s=x.data)?void 0:s.pagination}}async function c(e,l){let t=[],a=1;for(;;){var n;let{rows:i,pagination:r}=await o({page:a,limit:100,moduleId:e},l);if(t.push(...i),!(null!=(n=null==r?void 0:r.hasNext)?n:100===i.length))break;await s(150),a+=1}return t}async function u(e,l){let{data:t}=await n(()=>a.A.get("/permissions/getById/".concat(e),{signal:null==l?void 0:l.signal}));return d(t.data)}async function m(e){var l,t;let s=i({moduleId:e.moduleId,title:null==(l=e.title)?void 0:l.trim(),slug:r(e.slug),description:null==(t=e.description)?void 0:t.trim()},["moduleId","title","slug","description"]);try{let{data:e}=await n(()=>a.A.post("/permissions/create",s));return e.data}catch(l){let{data:e}=await n(()=>a.A.put("/permissions/create",s));return e.data}}async function h(e){var l,t;let s=i({id:e.id,moduleId:e.moduleId,title:null==(l=e.title)?void 0:l.trim(),slug:r(e.slug),description:null==(t=e.description)?void 0:t.trim(),is_active:e.is_active},["id","moduleId","title","slug","description","is_active"]),{data:d}=await n(()=>a.A.put("/permissions/update",s));return d.data}async function x(e){let{data:l}=await n(()=>a.A.delete("/permissions/delete",{data:{id:e}}));return l.data}},55343:(e,l,t)=>{Promise.resolve().then(t.bind(t,8006))},97636:(e,l,t)=>{"use strict";t.d(l,{T:()=>n});var a=t(20912);t(34012);var s=t(87343);function n(e){let{className:l,...t}=e;return(0,a.jsx)("textarea",{"data-slot":"textarea",className:(0,s.cn)("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",l),...t})}}},e=>{e.O(0,[590,809,57,292,641,424,290,808,4,358],()=>e(e.s=55343)),_N_E=e.O()}]);