(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[242],{13896:(e,s,l)=>{"use strict";l.r(s),l.d(s,{default:()=>D});var a=l(20912),t=l(34012),r=l(92292),n=l(7206),i=l(60362),d=l(40566),c=l(36641),o=l(81985),u=l(26831),m=l(15151),x=l(76301),h=l(34478),v=l(95370),j=l(21856),p=l(45082),f=l(65123),g=l(5255),w=l(10333),N=l(29083),y=l(71546),b=l(43239);let A=e=>new Promise(s=>setTimeout(s,e));async function C(e){let{retries:s=4,baseDelayMs:l=400,maxDelayMs:a=8e3}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=0;for(;;)try{return await e()}catch(u){var r,n,i;let e=null==u||null==(r=u.response)?void 0:r.status,d=function(e){if(!e)return null;let s=Number(e);return Number.isFinite(s)?Math.max(0,s):null}(null==u||null==(i=u.response)||null==(n=i.headers)?void 0:n["retry-after"]);if(!(429===e&&t<s))throw u;let c=null!=d?1e3*d:Math.min(a,Math.round(l*Math.pow(2,t))),o=c*(.4*Math.random()-.2);c=Math.max(200,Math.round(c+o)),await A(c),t+=1;continue}}async function S(){var e,s,l;let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,i=function(e,s){let l={};for(let a of s){let s=e[a];null!=s&&(l[a]=s)}return l}({page:a,limit:t,search:(null==r?void 0:r.trim())||void 0},["page","limit","search"]),{data:d}=await C(()=>b.A.get("/users/getAll",{params:i,signal:null==n?void 0:n.signal}));return{rows:null!=(l=null==d||null==(e=d.data)?void 0:e.users)?l:[],pagination:null==d||null==(s=d.data)?void 0:s.pagination}}async function E(e){let{data:s}=await C(()=>b.A.get("/users/getById/".concat(e)));return s.data}async function k(e){let{data:s}=await C(()=>b.A.post("/users/create",e));return s.data}async function M(e){let{data:s}=await C(()=>b.A.put("/users/update",e));return s.data}async function R(e){let{data:s}=await C(()=>b.A.delete("/users/delete",{data:{id:e}}));return s.data}var U=l(87997),_=l(52062),I=l(38272),F=l(47686);function T(e){var s,l,r;let{mode:n,open:i,onOpenChange:d,initialData:o,roles:u,onSubmit:m}=e,[x,h]=t.useState(null!=(s=null==o?void 0:o.name)?s:""),[j,f]=t.useState(null!=(l=null==o?void 0:o.email)?l:""),[g,w]=t.useState(""),[N,y]=t.useState(null!=(r=null==o?void 0:o.roleId)?r:"");t.useEffect(()=>{var e,s,l;i&&(h(null!=(e=null==o?void 0:o.name)?e:""),f(null!=(s=null==o?void 0:o.email)?s:""),w(""),y(null!=(l=null==o?void 0:o.roleId)?l:""))},[i,o]);let b=x.trim()&&j.trim()&&N&&("edit"===n||g);return(0,a.jsx)(_.lG,{open:i,onOpenChange:d,children:(0,a.jsxs)(_.Cf,{className:"sm:max-w-md",children:[(0,a.jsx)(_.c7,{children:(0,a.jsxs)(_.L3,{className:"flex items-center gap-2",children:[(0,a.jsx)(c.A,{className:"h-5 w-5"}),"create"===n?"Create New User":"Edit User"]})}),(0,a.jsxs)("form",{onSubmit:function(e){e.preventDefault();let s={id:null==o?void 0:o.id,name:x.trim(),email:j.trim(),roleId:N};g&&(s.password=g),null==m||m(s),d(!1)},className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(I.J,{htmlFor:"user-name",children:"Name *"}),(0,a.jsx)(p.p,{id:"user-name",placeholder:"Enter user name",value:x,onChange:e=>h(e.target.value),required:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(I.J,{htmlFor:"user-email",children:"Email *"}),(0,a.jsx)(p.p,{id:"user-email",type:"email",placeholder:"Enter email address",value:j,onChange:e=>f(e.target.value),required:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(I.J,{htmlFor:"user-password",children:["Password ","create"===n?"*":"(leave blank to keep current)"]}),(0,a.jsx)(p.p,{id:"user-password",type:"password",placeholder:"create"===n?"Enter password":"••••••••",value:g,onChange:e=>w(e.target.value),required:"create"===n})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(I.J,{children:"Role *"}),(0,a.jsxs)(F.l6,{value:N,onValueChange:y,children:[(0,a.jsx)(F.bq,{children:(0,a.jsx)(F.yv,{placeholder:"Select a role"})}),(0,a.jsx)(F.gC,{children:u.map(e=>(0,a.jsx)(F.eb,{value:e.id,children:e.title},e.id))})]})]}),(0,a.jsxs)(_.Es,{children:[(0,a.jsx)(v.$,{type:"button",variant:"outline",onClick:()=>d(!1),children:"Cancel"}),(0,a.jsx)(v.$,{type:"submit",disabled:!b,children:"create"===n?"Create":"Update"})]})]})]})})}var $=l(65988),q=l(37753);function D(){var e,s,l,b,A,C;let[_,I]=t.useState(!1);t.useEffect(()=>I(!0),[]);let[F,D]=t.useState([]),[P,H]=t.useState([]),[O,z]=t.useState(!0),[J,L]=t.useState(""),[B,Z]=t.useState(1),[G,Q]=t.useState(null),[V,W]=t.useState(!1),[X,Y]=t.useState("create"),[K,ee]=t.useState(null),es=(0,q.T)($.c.users.list),el=(0,q.T)($.c.users.create),ea=(0,q.T)($.c.users.update),et=(0,q.T)($.c.users.delete),[er,en]=t.useState("");t.useEffect(()=>{let e=setTimeout(()=>en(J.trim()),300);return()=>clearTimeout(e)},[J]),t.useEffect(()=>{Z(1)},[er]),t.useEffect(()=>{(async()=>{try{let{rows:e}=await (0,U.OH)(1,100);H(e)}catch(e){console.error(e)}})()},[]),t.useEffect(()=>{if(!_)return;let e=new AbortController;return(async()=>{try{if(z(!0),!es){D([]),Q(null);return}let{rows:s,pagination:l}=await S(B,5,er||void 0,{signal:e.signal});D(s),Q(null!=l?l:null)}catch(e){var s,l;if((null==e?void 0:e.code)==="ERR_CANCELED"||(null==e?void 0:e.message)==="canceled")return;console.error(e),r.oR.error((null==e||null==(l=e.response)||null==(s=l.data)?void 0:s.message)||"Failed to load users")}finally{z(!1)}})(),()=>e.abort()},[_,es,B,5,er]);let ei=async()=>{if(!es)return;let{rows:e,pagination:s}=await S(B,5,er||void 0);D(e),Q(null!=s?s:null)};async function ed(e){if(_&&el)try{await k({name:e.name,email:e.email,password:e.password,roleId:e.roleId}),r.oR.success("User created"),await ei()}catch(e){var s,l;console.error(e),r.oR.error((null==e||null==(l=e.response)||null==(s=l.data)?void 0:s.message)||"Create failed")}}async function ec(e){if(_&&ea)try{let s=await E(e);ee(s),Y("edit"),W(!0)}catch(e){var s,l;console.error(e),r.oR.error((null==e||null==(l=e.response)||null==(s=l.data)?void 0:s.message)||"Failed to open user")}}async function eo(e){if(_&&ea&&(null==K?void 0:K.id))try{let s={id:K.id,name:e.name,email:e.email,roleId:e.roleId};e.password&&(s.password=e.password),await M(s),r.oR.success("User updated"),await ei()}catch(e){var s,l;console.error(e),r.oR.error((null==e||null==(l=e.response)||null==(s=l.data)?void 0:s.message)||"Update failed")}}async function eu(e){if(_&&et&&window.confirm("Are you sure you want to delete this user?"))try{await R(e),r.oR.success("User deleted");let{rows:s,pagination:l}=await S(B,5,er||void 0);0===s.length&&B>1?Z(e=>e-1):(D(s),Q(null!=l?l:null))}catch(e){var s,l;console.error(e),r.oR.error((null==e||null==(l=e.response)||null==(s=l.data)?void 0:s.message)||"Delete failed")}}let em=null!=(s=null==G?void 0:G.total)?s:F.length,ex=null!=(l=null==G?void 0:G.page)?l:B,eh=(null!=(b=null==G?void 0:G.totalPages)?b:Math.ceil(em/5))||1,ev=null!=(A=null==G?void 0:G.hasPrev)?A:ex>1,ej=null!=(C=null==G?void 0:G.hasNext)?C:ex<eh,ep=0===em?0:(ex-1)*5+1,ef=0===em?0:Math.min(5*ex,em);return(0,a.jsx)(N.A,{screen:"/dashboard/users",mode:"block",children:(0,a.jsxs)("div",{className:"space-y-6 scrollbar-stable",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[(0,a.jsxs)("div",{className:"min-w-0",children:[(0,a.jsx)("h1",{className:"text-2xl sm:text-3xl font-bold truncate",children:"Users"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-muted-foreground",children:"Manage system users and their roles"})]}),(0,a.jsxs)(v.$,{className:"gap-2 w-full sm:w-auto",onClick:()=>{Y("create"),ee(null),W(!0)},disabled:!el,children:[(0,a.jsx)(n.A,{className:"h-4 w-4"}),"Add User"]})]}),(0,a.jsxs)(j.Zp,{className:"shadow-sm",children:[(0,a.jsx)(j.aR,{className:"space-y-3",children:(0,a.jsxs)("div",{className:"flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between",children:[(0,a.jsx)(j.ZB,{className:"text-xl sm:text-2xl",children:"All Users"}),(0,a.jsxs)("div",{className:"relative w-full sm:w-[260px] md:w-[320px] lg:w-[350px] max-w-full",children:[(0,a.jsx)(i.A,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),(0,a.jsx)(p.p,{className:"h-9 pl-9 w-full",placeholder:"Search users...",value:J,onChange:e=>L(e.target.value)})]})]})}),(0,a.jsx)(j.Wu,{className:"px-3 sm:px-6",children:O?(0,a.jsx)("div",{className:"p-8 text-center text-sm text-muted-foreground",children:"Loading users…"}):_&&!es?(0,a.jsx)("div",{className:"p-8 text-center text-sm text-muted-foreground",children:"You don't have permission to view users."}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"mt-1 rounded-xl border overflow-hidden overflow-x-auto",children:(0,a.jsxs)(y.XI,{className:"min-w-[720px]",children:[(0,a.jsx)(y.A0,{children:(0,a.jsxs)(y.Hj,{className:"bg-gray-200",children:[(0,a.jsx)(y.nd,{className:"rounded-tl-xl",children:"User"}),(0,a.jsx)(y.nd,{children:"Email"}),(0,a.jsx)(y.nd,{children:"Role"}),(0,a.jsx)(y.nd,{children:"Created At"}),(0,a.jsx)(y.nd,{children:"Status"}),(0,a.jsx)(y.nd,{className:"text-right rounded-tr-xl",children:"Actions"})]})}),(0,a.jsx)(y.BF,{children:0===F.length?(0,a.jsx)(y.Hj,{children:(0,a.jsx)(y.nA,{colSpan:6,className:"p-8 text-center text-muted-foreground",children:(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center gap-3",children:[(0,a.jsx)(w.eu,{className:"h-16 w-16 border border-dashed border-muted-foreground/30 bg-muted/40",children:(0,a.jsx)(w.q5,{children:(0,a.jsx)(d.A,{className:"h-7 w-7 text-muted-foreground"})})}),(0,a.jsx)("div",{className:"text-sm font-medium text-foreground",children:"No users found"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground max-w-xs",children:J?"No users match your search.":"Create your first user to get started."})]})})}):F.map((e,s)=>{var l,t;let r=s===F.length-1;return(0,a.jsxs)(y.Hj,{className:"odd:bg-muted/30 even:bg-white hover:bg-transparent",children:[(0,a.jsx)(y.nA,{className:r?"rounded-bl-xl":"",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(w.eu,{className:"h-9 w-9 shrink-0",children:(0,a.jsx)(w.q5,{className:"bg-primary/10 text-primary",children:(null==(l=e.name)?void 0:l.slice(0,2).toUpperCase())||(0,a.jsx)(c.A,{className:"h-4 w-4"})})}),(0,a.jsx)("div",{className:"min-w-0",children:(0,a.jsx)("div",{className:"font-medium truncate",children:e.name})})]})}),(0,a.jsx)(y.nA,{className:"text-sm text-muted-foreground",children:e.email}),(0,a.jsx)(y.nA,{children:(0,a.jsx)(f.E,{variant:"outline",children:(null==(t=e.role)?void 0:t.title)||"No role"})}),(0,a.jsx)(y.nA,{className:"text-sm text-muted-foreground",children:(e=>{if(!_)return"—";try{return new Date(e).toLocaleString()}catch(s){return e}})(e.created_at)}),(0,a.jsx)(y.nA,{children:(0,a.jsx)(f.E,{variant:e.is_active?"default":"secondary",children:e.is_active?"Active":"Inactive"})}),(0,a.jsx)(y.nA,{className:"text-right ".concat(r?"rounded-br-xl":""),children:(0,a.jsxs)(g.rI,{children:[(0,a.jsx)(g.ty,{asChild:!0,children:(0,a.jsx)(v.$,{variant:"ghost",size:"icon",className:"h-8 w-8","aria-label":"More actions",children:(0,a.jsx)(o.A,{className:"h-4 w-4"})})}),(0,a.jsxs)(g.SQ,{align:"end",className:"w-40",children:[ea&&(0,a.jsxs)(g._2,{className:"gap-2",onClick:()=>ec(e.id),children:[(0,a.jsx)(u.A,{className:"h-4 w-4"}),"Edit"]}),et&&(0,a.jsxs)(g._2,{className:"gap-2 text-destructive focus:text-destructive",onClick:()=>eu(e.id),children:[(0,a.jsx)(m.A,{className:"h-4 w-4"}),"Delete"]})]})]})})]},e.id)})})]})}),(0,a.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between mt-4",children:[(0,a.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Showing ",ep," to ",ef," of ",em," users"]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2 justify-end",children:[(0,a.jsxs)(v.$,{variant:"outline",size:"sm",disabled:!ev,className:"gap-1",onClick:()=>Z(e=>Math.max(1,e-1)),children:[(0,a.jsx)(x.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"Previous"})]}),(0,a.jsx)("div",{className:"flex items-center gap-1",children:Array.from({length:eh},(e,s)=>s+1).map(e=>(0,a.jsx)(v.$,{variant:e===ex?"default":"outline",size:"sm",onClick:()=>Z(e),className:"w-8 h-8 p-0 text-xs",children:e},e))}),(0,a.jsxs)(v.$,{variant:"outline",size:"sm",disabled:!ej,className:"gap-1",onClick:()=>Z(e=>e+1),children:[(0,a.jsx)("span",{className:"hidden sm:inline",children:"Next"}),(0,a.jsx)(h.A,{className:"h-4 w-4"})]})]})]})]})})]}),(0,a.jsx)(T,{mode:X,open:V,onOpenChange:e=>{W(e),e||ee(null)},initialData:K?{id:K.id,name:K.name,email:K.email,roleId:(null==(e=K.role)?void 0:e.id)||""}:null,roles:P,onSubmit:"create"===X?ed:eo})]})})}},36641:(e,s,l)=>{"use strict";l.d(s,{A:()=>a});let a=(0,l(60080).A)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},48226:(e,s,l)=>{Promise.resolve().then(l.bind(l,13896))}},e=>{e.O(0,[809,57,292,641,189,290,741,808,4,358],()=>e(e.s=48226)),_N_E=e.O()}]);